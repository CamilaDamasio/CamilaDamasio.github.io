{"ast":null,"code":"import _objectSpread from\"/home/camila/Repositorios_GitHub/project-recipes-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/home/camila/Repositorios_GitHub/project-recipes-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/home/camila/Repositorios_GitHub/project-recipes-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/home/camila/Repositorios_GitHub/project-recipes-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/camila/Repositorios_GitHub/project-recipes-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/camila/Repositorios_GitHub/project-recipes-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useParams,Redirect}from'react-router-dom';import{Button,Form}from'react-bootstrap';import ShareBtn from'../components/ShareBtn';import whiteHeartIcon from\"../images/whiteHeartIcon.svg\";import blackHeartIcon from\"../images/blackHeartIcon.svg\";import{foodById}from'../utils/fetchAPIbyID';import useRedirect from'../hooks/useRedirect';import HeaderWithoutSearch from'../components/HeaderWithoutSearch';function FoodInProgress(){var _useParams=useParams(),id=_useParams.id;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),foodDetails=_useState2[0],setFoodDetails=_useState2[1];var _useRedirect=useRedirect(),shouldRedirect=_useRedirect.shouldRedirect,redirect=_useRedirect.redirect;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),progress=_useState4[0],setProgress=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),disabled=_useState6[0],setDisabled=_useState6[1];useEffect(function(){var fetchMeals=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var food,inProgressRecipes,meals,loadedProgress,inputs;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return foodById(id);case 2:food=_context.sent;setFoodDetails(food);inProgressRecipes=JSON.parse(localStorage.getItem('inProgressRecipes'));if(inProgressRecipes&&progress.length===0&&Object.keys(inProgressRecipes.meals).some(function(key){return key===id;})){meals=inProgressRecipes.meals;loadedProgress=meals[id];setProgress(loadedProgress);inputs=document.querySelectorAll('input');if(inputs){inputs.forEach(function(input){if(loadedProgress.some(function(value){return value===input.parentElement.querySelector('label').innerText;})){input.defaultChecked=true;input.parentElement.querySelector('label').style.textDecoration='line-through';}});}}case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetchMeals(){return _ref.apply(this,arguments);};}();var favoriteRecipes=JSON.parse(localStorage.getItem('favoriteRecipes'));if(favoriteRecipes){var isFavorite=function isFavorite(){return favoriteRecipes.some(function(recipe){return recipe.id===id;})&&document.getElementById('fav-btn').setAttribute('src',blackHeartIcon);};isFavorite();}fetchMeals();},[id,progress]);var retObj=Object.entries(foodDetails);var listIngredients=retObj.filter(function(meal){return meal[0].includes('Ingredient')&&meal[1];});var filterAlcoohol=retObj.filter(function(meal){var noAlcool=meal[1]!==' '&&meal[1]!==null;return meal[0].includes('Measure')&&noAlcool;});var progressRecipe=function progressRecipe(labelValue){var updatedProgress=[];if(!progress.some(function(value){return value===labelValue;})){updatedProgress=progress.concat(labelValue);setProgress(updatedProgress);}else{updatedProgress=progress.filter(function(ingredient){return ingredient!==labelValue;});setProgress(updatedProgress);}var inProgressRecipes=JSON.parse(localStorage.getItem('inProgressRecipes'));if(!inProgressRecipes){inProgressRecipes={meals:_defineProperty({},id,updatedProgress)};}else{var _inProgressRecipes=inProgressRecipes,meals=_inProgressRecipes.meals;if(inProgressRecipes.meals){meals[id]=updatedProgress;}else{var recipeProgress=_defineProperty({},id,_toConsumableArray(updatedProgress));meals=_objectSpread(_objectSpread({},meals),recipeProgress);}inProgressRecipes.meals=meals;}localStorage.setItem('inProgressRecipes',JSON.stringify(inProgressRecipes));};var isDisabled=function isDisabled(){var el=document.querySelectorAll('input');if(!Array.from(el).every(function(x){return x.checked;})){setDisabled(true);}else{setDisabled(false);}};var finishRecipe=function finishRecipe(){var strArea=foodDetails.strArea,strCategory=foodDetails.strCategory,strMealThumb=foodDetails.strMealThumb,strMeal=foodDetails.strMeal,strTags=foodDetails.strTags;var d=new Date();var dataDMY=\"\".concat(d.getDay(),\"/\").concat(d.getMonth(),\"/\").concat(d.getFullYear());var dataTIME=\"\".concat(d.getHours(),\"hrs\").concat(d.getMinutes(),\"min\");var arrTag;if(strTags){arrTag=strTags.split(',');}else{arrTag='';}var finishedRecipeToken={id:id,type:'comida',area:strArea,category:strCategory,alcoholicOrNot:'',name:strMeal,image:strMealThumb,doneDate:\"\".concat(dataDMY,\" \\xE0s \").concat(dataTIME),tags:arrTag};var inProgressRecipes=JSON.parse(localStorage.getItem('inProgressRecipes'));if((Object.keys(inProgressRecipes).length&&Object.keys(inProgressRecipes.meals).length)===1){localStorage.removeItem('inProgressRecipes');}else{delete inProgressRecipes.meals[id];}var doneRecipes=JSON.parse(localStorage.getItem('doneRecipes'));if(doneRecipes){doneRecipes.push(finishedRecipeToken);}else{doneRecipes=[finishedRecipeToken];}localStorage.setItem('doneRecipes',JSON.stringify(doneRecipes));shouldRedirect('/receitas-feitas');};var setFavorite=function setFavorite(){var strArea=foodDetails.strArea,strCategory=foodDetails.strCategory,strMealThumb=foodDetails.strMealThumb,strMeal=foodDetails.strMeal;var favoriteRecipeToken={id:id,type:'comida',area:strArea,category:strCategory,alcoholicOrNot:'',name:strMeal,image:strMealThumb};var favoriteRecipes=JSON.parse(localStorage.getItem('favoriteRecipes'));if(favoriteRecipes){if(favoriteRecipes.some(function(recipe){return recipe.id!==favoriteRecipeToken.id;})){favoriteRecipes.push(favoriteRecipeToken);document.getElementById('fav-btn').setAttribute('src',blackHeartIcon);}else{favoriteRecipes=favoriteRecipes.filter(function(recipe){return recipe.id!==favoriteRecipeToken.id;});document.getElementById('fav-btn').setAttribute('src',whiteHeartIcon);}}else{favoriteRecipes=[favoriteRecipeToken];document.getElementById('fav-btn').src=blackHeartIcon;}localStorage.setItem('favoriteRecipes',JSON.stringify(favoriteRecipes));if(Object.values(favoriteRecipes).length===0){localStorage.removeItem('favoriteRecipes');}};return/*#__PURE__*/React.createElement(\"div\",{onChange:isDisabled,className:\"in-progress\"},redirect.should&&/*#__PURE__*/React.createElement(Redirect,{to:redirect.path}),/*#__PURE__*/React.createElement(HeaderWithoutSearch,null,\"Receita em Progresso\"),/*#__PURE__*/React.createElement(\"img\",{src:foodDetails.strMealThumb,alt:\"imagem da comida\",\"data-testid\":\"recipe-photo\",className:\"in-progress-pic\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"detail-card\"},/*#__PURE__*/React.createElement(\"h3\",{\"data-testid\":\"recipe-title\"},foodDetails.strMeal),/*#__PURE__*/React.createElement(\"div\",{className:\"details-btn-div\"},/*#__PURE__*/React.createElement(ShareBtn,{id:id,type:\"comida\"}),/*#__PURE__*/React.createElement(Button,{variant:\"danger\",type:\"button\",onClick:setFavorite,className:\"favorite-btn\"},/*#__PURE__*/React.createElement(\"img\",{id:\"fav-btn\",className:\"icon\",src:whiteHeartIcon,alt:\"favoritar\",\"data-testid\":\"favorite-btn\"})))),/*#__PURE__*/React.createElement(\"p\",{\"data-testid\":\"recipe-category\"},/*#__PURE__*/React.createElement(\"span\",null,\"Categoria: \"),foodDetails.strCategory),/*#__PURE__*/React.createElement(\"div\",{className:\"list-ingredients\"},/*#__PURE__*/React.createElement(\"h4\",null,\"Ingredientes\"),/*#__PURE__*/React.createElement(\"ul\",null,listIngredients.map(function(ingredient,index){return/*#__PURE__*/React.createElement(\"li\",{className:\"in-progress-list\",key:index,\"data-testid\":\"\".concat(index,\"-ingredient-step\")},/*#__PURE__*/React.createElement(Form.Group,{className:\"mb-3\",controlId:\"\".concat(index,\"-ingredient-step\")},/*#__PURE__*/React.createElement(Form.Check,{type:\"checkbox\",id:\"\".concat(index,\"-ingredient-step\"),label:filterAlcoohol[index]?\"\".concat(ingredient[1],\" - \").concat(filterAlcoohol[index][1]):ingredient[1],onChange:function onChange(_ref2){var target=_ref2.target;var label=target.parentElement.querySelector('label');progressRecipe(label.innerText);if(target.checked){label.style.textDecoration='line-through';}else if(!target.checked){target.defaultChecked=false;label.style.textDecoration='none';}}})));}))),/*#__PURE__*/React.createElement(\"strong\",null,\"Instru\\xE7\\xF5es\"),/*#__PURE__*/React.createElement(\"p\",{className:\"instructions\",\"data-testid\":\"instructions\"},foodDetails.strInstructions),/*#__PURE__*/React.createElement(Button,{disabled:disabled,type:\"button\",\"data-testid\":\"finish-recipe-btn\",className:\"finishRecipe\",onClick:finishRecipe},\"Finalizar Receita\"));}export default FoodInProgress;","map":{"version":3,"sources":["/home/camila/Repositorios_GitHub/project-recipes-app/src/pages/FoodInProgress.jsx"],"names":["React","useState","useEffect","useParams","Redirect","Button","Form","ShareBtn","foodById","useRedirect","HeaderWithoutSearch","FoodInProgress","id","foodDetails","setFoodDetails","shouldRedirect","redirect","progress","setProgress","disabled","setDisabled","fetchMeals","food","inProgressRecipes","JSON","parse","localStorage","getItem","length","Object","keys","meals","some","key","loadedProgress","inputs","document","querySelectorAll","forEach","input","value","parentElement","querySelector","innerText","defaultChecked","style","textDecoration","favoriteRecipes","isFavorite","recipe","getElementById","setAttribute","blackHeartIcon","retObj","entries","listIngredients","filter","meal","includes","filterAlcoohol","noAlcool","progressRecipe","labelValue","updatedProgress","concat","ingredient","recipeProgress","setItem","stringify","isDisabled","el","Array","from","every","x","checked","finishRecipe","strArea","strCategory","strMealThumb","strMeal","strTags","d","Date","dataDMY","getDay","getMonth","getFullYear","dataTIME","getHours","getMinutes","arrTag","split","finishedRecipeToken","type","area","category","alcoholicOrNot","name","image","doneDate","tags","removeItem","doneRecipes","push","setFavorite","favoriteRecipeToken","whiteHeartIcon","src","values","should","path","map","index","target","label","strInstructions"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, Redirect } from 'react-router-dom';\nimport { Button, Form } from 'react-bootstrap';\nimport ShareBtn from '../components/ShareBtn';\nimport whiteHeartIcon from '../images/whiteHeartIcon.svg';\nimport blackHeartIcon from '../images/blackHeartIcon.svg';\nimport { foodById } from '../utils/fetchAPIbyID';\nimport useRedirect from '../hooks/useRedirect';\nimport HeaderWithoutSearch from '../components/HeaderWithoutSearch';\n\nfunction FoodInProgress() {\n  const { id } = useParams();\n  const [foodDetails, setFoodDetails] = useState({});\n  const { shouldRedirect, redirect } = useRedirect();\n  const [progress, setProgress] = useState([]);\n  const [disabled, setDisabled] = useState(true);\n  useEffect(() => {\n    const fetchMeals = async () => {\n      const food = await foodById(id);\n      setFoodDetails(food);\n      const inProgressRecipes = JSON.parse(localStorage.getItem('inProgressRecipes'));\n      if (inProgressRecipes && progress\n        .length === 0 && Object.keys(inProgressRecipes.meals)\n        .some((key) => key === id)) {\n        const { meals } = inProgressRecipes;\n        const loadedProgress = meals[id];\n        setProgress(loadedProgress);\n        const inputs = document.querySelectorAll('input');\n        if (inputs) {\n          inputs.forEach((input) => {\n            if (loadedProgress.some((value) => value === input.parentElement\n              .querySelector('label').innerText)) {\n              input.defaultChecked = true;\n              input.parentElement\n                .querySelector('label').style.textDecoration = 'line-through';\n            }\n          });\n        }\n      }\n    };\n    const favoriteRecipes = JSON.parse(localStorage.getItem('favoriteRecipes'));\n    if (favoriteRecipes) {\n      const isFavorite = () => favoriteRecipes\n        .some((recipe) => recipe.id === id) && document.getElementById('fav-btn')\n        .setAttribute('src', blackHeartIcon);\n      isFavorite();\n    }\n    fetchMeals();\n  }, [id, progress]);\n\n  const retObj = Object.entries(foodDetails);\n  const listIngredients = retObj.filter((meal) => (\n    meal[0].includes('Ingredient') && meal[1]\n  ));\n  const filterAlcoohol = retObj.filter((meal) => {\n    const noAlcool = meal[1] !== ' ' && meal[1] !== null;\n    return meal[0].includes('Measure') && noAlcool;\n  });\n\n  const progressRecipe = (labelValue) => {\n    let updatedProgress = [];\n    if (!progress.some((value) => value === labelValue)) {\n      updatedProgress = progress.concat(labelValue);\n      setProgress(updatedProgress);\n    } else {\n      updatedProgress = progress.filter((ingredient) => ingredient !== labelValue);\n      setProgress(updatedProgress);\n    }\n    let inProgressRecipes = JSON.parse(localStorage.getItem('inProgressRecipes'));\n    if (!inProgressRecipes) {\n      inProgressRecipes = {\n        meals: { [id]: updatedProgress },\n      };\n    } else {\n      let { meals } = inProgressRecipes;\n      if (inProgressRecipes.meals) {\n        meals[id] = updatedProgress;\n      } else {\n        const recipeProgress = { [id]: [...updatedProgress] };\n        meals = { ...meals, ...recipeProgress };\n      }\n      inProgressRecipes.meals = meals;\n    }\n    localStorage.setItem('inProgressRecipes', JSON.stringify(inProgressRecipes));\n  };\n\n  const isDisabled = () => {\n    const el = document.querySelectorAll('input');\n    if (!(Array.from(el).every((x) => x.checked))) {\n      setDisabled(true);\n    } else {\n      setDisabled(false);\n    }\n  };\n  const finishRecipe = () => {\n    const { strArea, strCategory, strMealThumb, strMeal, strTags } = foodDetails;\n    const d = new Date();\n    const dataDMY = `${d.getDay()}/${d.getMonth()}/${d.getFullYear()}`;\n    const dataTIME = `${d.getHours()}hrs${d.getMinutes()}min`;\n    let arrTag;\n    if (strTags) {\n      arrTag = strTags.split(',');\n    } else {\n      arrTag = '';\n    }\n    const finishedRecipeToken = {\n      id,\n      type: 'comida',\n      area: strArea,\n      category: strCategory,\n      alcoholicOrNot: '',\n      name: strMeal,\n      image: strMealThumb,\n      doneDate: `${dataDMY} às ${dataTIME}`,\n      tags: arrTag,\n    };\n    const inProgressRecipes = JSON.parse(localStorage.getItem('inProgressRecipes'));\n    if ((Object.keys(inProgressRecipes)\n      .length && Object.keys(inProgressRecipes.meals).length) === 1) {\n      localStorage.removeItem('inProgressRecipes');\n    } else {\n      delete inProgressRecipes.meals[id];\n    }\n    let doneRecipes = JSON.parse(localStorage.getItem('doneRecipes'));\n    if (doneRecipes) {\n      doneRecipes.push(finishedRecipeToken);\n    } else {\n      doneRecipes = [finishedRecipeToken];\n    }\n    localStorage.setItem('doneRecipes', JSON.stringify(doneRecipes));\n    shouldRedirect('/receitas-feitas');\n  };\n  const setFavorite = () => {\n    const { strArea, strCategory, strMealThumb, strMeal } = foodDetails;\n    const favoriteRecipeToken = {\n      id,\n      type: 'comida',\n      area: strArea,\n      category: strCategory,\n      alcoholicOrNot: '',\n      name: strMeal,\n      image: strMealThumb,\n    };\n    let favoriteRecipes = JSON.parse(localStorage.getItem('favoriteRecipes'));\n    if (favoriteRecipes) {\n      if (favoriteRecipes.some((recipe) => recipe.id !== favoriteRecipeToken.id)) {\n        favoriteRecipes.push(favoriteRecipeToken);\n        document.getElementById('fav-btn').setAttribute('src', blackHeartIcon);\n      } else {\n        favoriteRecipes = favoriteRecipes\n          .filter((recipe) => recipe.id !== favoriteRecipeToken.id);\n        document.getElementById('fav-btn').setAttribute('src', whiteHeartIcon);\n      }\n    } else {\n      favoriteRecipes = [favoriteRecipeToken];\n      document.getElementById('fav-btn').src = blackHeartIcon;\n    }\n    localStorage.setItem('favoriteRecipes', JSON.stringify(favoriteRecipes));\n    if (Object.values(favoriteRecipes).length === 0) {\n      localStorage.removeItem('favoriteRecipes');\n    }\n  };\n  return (\n    <div onChange={ isDisabled } className=\"in-progress\">\n      { redirect.should && <Redirect to={ redirect.path } />}\n      <HeaderWithoutSearch>Receita em Progresso</HeaderWithoutSearch>\n      <img\n        src={ foodDetails.strMealThumb }\n        alt=\"imagem da comida\"\n        data-testid=\"recipe-photo\"\n        className=\"in-progress-pic\"\n      />\n      <div className=\"detail-card\">\n        <h3 data-testid=\"recipe-title\">{ foodDetails.strMeal }</h3>\n        <div className=\"details-btn-div\">\n\n          <ShareBtn id={ id } type=\"comida\" />\n          <Button\n            variant=\"danger\"\n            type=\"button\"\n            onClick={ setFavorite }\n            className=\"favorite-btn\"\n          >\n            <img\n              id=\"fav-btn\"\n              className=\"icon\"\n              src={ whiteHeartIcon }\n              alt=\"favoritar\"\n              data-testid=\"favorite-btn\"\n            />\n          </Button>\n        </div>\n      </div>\n      <p data-testid=\"recipe-category\">\n        <span>Categoria: </span>\n        { foodDetails.strCategory }\n      </p>\n      <div className=\"list-ingredients\">\n        <h4>Ingredientes</h4>\n        <ul>\n          {listIngredients.map((ingredient, index) => (\n            <li\n              className=\"in-progress-list\"\n              key={ index }\n              data-testid={ `${index}-ingredient-step` }\n            >\n              <Form.Group className=\"mb-3\" controlId={ `${index}-ingredient-step` }>\n                <Form.Check\n                  type=\"checkbox\"\n                  id={ `${index}-ingredient-step` }\n                  label={ filterAlcoohol[index] ? (\n                    `${ingredient[1]} - ${filterAlcoohol[index][1]}`\n                  ) : (ingredient[1]) }\n                  onChange={ ({ target }) => {\n                    const label = target.parentElement.querySelector('label');\n                    progressRecipe(label.innerText);\n                    if (target.checked) {\n                      label.style.textDecoration = 'line-through';\n                    } else if (!target.checked) {\n                      target.defaultChecked = false;\n                      label.style.textDecoration = 'none';\n                    }\n                  } }\n                />\n              </Form.Group>\n            </li>\n          ))}\n        </ul>\n      </div>\n      <strong>Instruções</strong>\n      <p\n        className=\"instructions\"\n        data-testid=\"instructions\"\n      >\n        { foodDetails.strInstructions }\n      </p>\n      <Button\n        disabled={ disabled }\n        type=\"button\"\n        data-testid=\"finish-recipe-btn\"\n        className=\"finishRecipe\"\n        onClick={ finishRecipe }\n      >\n        Finalizar Receita\n      </Button>\n    </div>\n  );\n}\nexport default FoodInProgress;\n"]},"metadata":{},"sourceType":"module"}